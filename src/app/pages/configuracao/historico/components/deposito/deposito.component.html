<div class="space-y-6">
  <div class="flex justify-between">
    <div>
      <h3 class="text-lg font-semibold text-primary">Minhas Solicitações de Depósito</h3>
      <p class="text-secondary text-sm">Acompanhe o status das suas solicitações de saque</p>
    </div>

    <p-button
      icon="pi pi-refresh"
      (onClick)="refresh.emit()"
      [loading]="loading"
      [outlined]="true"
      size="small"
    ></p-button>
  </div>

  <div *ngIf="loading" class="flex justify-center py-8">
    <p-progressSpinner styleClass="w-12 h-12"></p-progressSpinner>
  </div>

  <div *ngIf="!loading" class="bg-card rounded-lg shadow overflow-hidden">
    <div *ngIf="depositos.length === 0" class="p-8 text-center">
      <div class="flex flex-col items-center">
        <i class="pi pi-info-circle text-secondary text-4xl mb-4"></i>
        <p class="text-secondary text-lg mb-2">Nenhuma solicitação encontrada</p>
        <p class="text-secondary text-sm opacity-70">Tente ajustar os filtros para ver mais resultados</p>
      </div>
    </div>

    <div *ngIf="depositos.length > 0" class="overflow-x-auto">
      <p-table
        [value]="depositos"
        [tableStyle]="{ 'min-width': '50rem' }"
        styleClass="p-datatable-sm"
        [paginator]="depositos.length > 10"
        [rows]="10"
        [rowsPerPageOptions]="[10, 25, 50]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} solicitações"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="campanha.title" style="width: 20%">
              Campanha
              <p-sortIcon field="campanha.title"></p-sortIcon>
              <p-columnFilter
                type="text"
                field="campanha.title"
                matchMode="contains"
                display="menu"
                [showApplyButton]="false"
                [hideOnClear]="true"
                [showMatchModes]="false"
                [showOperator]="false"
                [showAddButton]="false"
              ></p-columnFilter>
            </th>
            <th pSortableColumn="campanha.value_donated" style="width: 20%">
              Valor
              <p-sortIcon field="campanha.value_donated"></p-sortIcon>
              <p-columnFilter
                type="numeric"
                field="campanha.value_donated"
                matchMode="contains"
                display="menu"
                [showApplyButton]="false"
                [hideOnClear]="true"
                [showMatchModes]="false"
                [showOperator]="false"
                [showAddButton]="false"
              ></p-columnFilter>
            </th>
            <th pSortableColumn="created_at" style="width: 18%">
              Data Solicitação
              <p-sortIcon field="created_at"></p-sortIcon>
              <p-columnFilter
                type="date"
                field="created_at"
                display="menu"
                [showApplyButton]="false"
                [hideOnClear]="true"
                [showMatchModes]="false"
                [showOperator]="false"
                [showAddButton]="false"
              ></p-columnFilter>
            </th>
            <th pSortableColumn="updated_at" style="width: 18%">
              Data Atualização
              <p-sortIcon field="updated_at"></p-sortIcon>
              <p-columnFilter
                type="date"
                field="updated_at"
                display="menu"
                [showApplyButton]="false"
                [hideOnClear]="true"
                [showMatchModes]="false"
                [showOperator]="false"
                [showAddButton]="false"
              ></p-columnFilter>
            </th>
            <th pSortableColumn="status" style="width: 12%">
              Status
              <p-sortIcon field="status"></p-sortIcon>
              <p-columnFilter
                field="status"
                matchMode="equals"
                display="menu"
                [showApplyButton]="false"
                [hideOnClear]="true"
                [showMatchModes]="false"
                [showOperator]="false"
                [showAddButton]="false"
              >
                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                  <p-dropdown
                    [ngModel]="value"
                    [options]="statusDepositList"
                    (onChange)="filter($event.value)"
                    placeholder="Todos"
                  >
                    <ng-template let-option pTemplate="item">
                      <p-tag [value]="option.value" [severity]="getStatusSeverity(option.value)" />
                    </ng-template>
                  </p-dropdown>
                </ng-template>
              </p-columnFilter>
            </th>
            <th pSortableColumn="justification_admin" style="width: 30%">
              Resposta Admin
              <p-sortIcon field="justification_admin"></p-sortIcon>
              <p-columnFilter
                type="text"
                field="justification_admin"
                matchMode="contains"
                display="menu"
                [showApplyButton]="false"
                [hideOnClear]="true"
                [showMatchModes]="false"
                [showOperator]="false"
                [showAddButton]="false"
              ></p-columnFilter>
            </th>
            <th></th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-deposito>
          <tr>
            <td>
              <div class="font-medium text-primary">{{ deposito.campanha?.title }}</div>
              <span class="text-sm text-secondary">ID: {{ deposito.campanha?.campanha_id }}</span>
            </td>
            <td>
              <div class="font-semibold text-green-600">
                {{ deposito.campanha.value_donated || 0 | currency: 'BRL' : 'symbol' : '1.2-2' }}
              </div>
            </td>
            <td>
              <div class="text-sm text-primary">{{ deposito.created_at | date: 'dd/MM/yyyy' }}</div>
            </td>
            <td>
              <div class="text-sm text-primary">{{ deposito.updated_at | date: 'dd/MM/yyyy' }}</div>
            </td>
            <td>
              <p-tag [value]="deposito.status" [severity]="getStatusSeverity(deposito.status)"></p-tag>
            </td>
            <td>
              <div class="text-sm text-secondary max-w-xs truncate">{{ deposito.justification_admin || '--' }}</div>
            </td>
            <td>
              <p-button
                icon="pi pi-eye"
                size="small"
                severity="secondary"
                [text]="true"
                pTooltip="Ver detalhes completos"
                (onClick)="viewDetails(deposito)"
                class="ml-2"
              ></p-button>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="5" class="text-center py-8">
              <div class="flex flex-col items-center">
                <i class="pi pi-info-circle text-secondary text-3xl mb-2"></i>
                <p class="text-secondary">Nenhuma solicitação encontrada</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>
<p-dialog
  [(visible)]="modalDetalhes"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  header="Detalhes da Solicitação"
  styleClass="w-full max-w-2xl"
>
  <div *ngIf="selectedDeposito" class="space-y-4">
    <div class="bg-surface border border-theme rounded-lg p-4">
      <h4 class="font-semibold text-primary mb-2">Informações da Campanha</h4>
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <span class="text-secondary">Título:</span>
          <p class="font-medium text-primary">
            {{ selectedDeposito.campanha?.title || selectedDeposito.campanha?.title }}
          </p>
        </div>
        <div>
          <span class="text-secondary">Status da Campanha:</span>
          <p class="font-medium text-primary">{{ selectedDeposito.campanha?.status || 'N/A' }}</p>
        </div>
        <div *ngIf="selectedDeposito.campanha?.value_required">
          <span class="text-secondary">Meta:</span>
          <p class="font-medium text-primary">
            {{ selectedDeposito.campanha?.value_required | currency: 'BRL' : 'symbol' : '1.2-2' }}
          </p>
        </div>
        <div *ngIf="selectedDeposito.campanha?.value_donated">
          <span class="text-secondary">Arrecadado:</span>
          <p class="font-medium text-primary">
            {{ selectedDeposito.campanha?.value_donated | currency: 'BRL' : 'symbol' : '1.2-2' }}
          </p>
        </div>
      </div>
    </div>

    <div class="bg-surface border border-theme rounded-lg p-4">
      <h4 class="font-semibold text-primary mb-2">Detalhes da Solicitação</h4>
      <div class="space-y-3 text-sm">
        <div>
          <span class="text-secondary">Valor Solicitado:</span>
          <p class="font-medium text-green-600">
            {{ selectedDeposito.campanha?.value_donated || 0 | currency: 'BRL' : 'symbol' : '1.2-2' }}
          </p>
        </div>
        <div>
          <span class="text-secondary">Data da Solicitação:</span>
          <p class="font-medium text-primary">
            {{ selectedDeposito.created_at | date: 'dd/MM/yyyy' }}
          </p>
        </div>
        <div>
          <span class="text-secondary">Status:</span>
          <div class="mt-1">
            <p-tag [value]="selectedDeposito.status" [severity]="getStatusSeverity(selectedDeposito.status)"></p-tag>
          </div>
        </div>
        <div *ngIf="selectedDeposito.justification_admin">
          <span class="text-secondary">Resposta do Administrador:</span>
          <p class="mt-1 p-3 bg-card border border-theme rounded text-primary">
            {{ selectedDeposito.justification_admin }}
          </p>
        </div>
      </div>
    </div>

    <div class="flex justify-end gap-3 pt-4 border-t border-theme">
      <p-button label="Fechar" severity="secondary" [text]="true" (onClick)="modalDetalhes = false"></p-button>
    </div>
  </div>
</p-dialog>

