<section class="space-y-6">
  <div class="flex justify-between items-center">
    <div>
      <h3 class="text-lg font-semibold text-primary">Minhas Doações</h3>
      <p class="text-secondary text-sm">Acompanhe o histórico das suas contribuições</p>
    </div>

    <p-button
      icon="pi pi-refresh"
      (onClick)="refresh.emit()"
      [loading]="loading"
      [outlined]="true"
      size="small"
    ></p-button>
  </div>

  <div *ngIf="loading" class="flex justify-center py-8">
    <p-progressSpinner styleClass="w-12 h-12"></p-progressSpinner>
  </div>

  <div *ngIf="!loading" class="bg-card rounded-lg shadow overflow-hidden">
    <div *ngIf="doacoesFiltered.length === 0" class="p-8 text-center">
      <div class="flex flex-col items-center">
        <i class="pi pi-info-circle text-secondary text-4xl mb-4"></i>
        <p class="text-secondary text-lg mb-2">Nenhuma doação encontrada</p>
        <p class="text-secondary text-sm opacity-70">Tente ajustar os filtros para ver mais resultados</p>
      </div>
    </div>

    <div *ngIf="doacoesFiltered.length > 0" class="overflow-x-auto">
      <table class="min-w-full">
        <thead class="bg-surface">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-secondary uppercase tracking-wider">Campanha</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-secondary uppercase tracking-wider">Valor Doado</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-secondary uppercase tracking-wider">Data</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-secondary uppercase tracking-wider">Pagamento</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-secondary uppercase tracking-wider">Status</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-secondary uppercase tracking-wider">Ações</th>
          </tr>
        </thead>
        <tbody class="bg-card divide-y border-theme">
          <tr *ngFor="let doacao of doacoesFiltered" class="hover:bg-hover">
            <td class="px-6 py-4 font-medium text-primary">
              {{ doacao.title_campanha }}
            </td>
            <td class="px-6 py-4 font-semibold text-green-600">
              {{ doacao.amount | currency: 'BRL' : 'symbol' : '1.2-2' }}
            </td>
            <td class="px-6 py-4 text-sm text-primary">
              {{ doacao.created_at | date: 'dd/MM/yyyy HH:mm' }}
            </td>
            <td class="px-6 py-4">
              <div class="flex items-center">
                <i
                  class="pi mr-2"
                  [ngClass]="{
                    'pi-credit-card text-blue-600': doacao.payment_method === 'Cartão de Crédito',
                    'pi-mobile text-green-600': doacao.payment_method === 'Pix',
                    'pi-money-bill text-orange-600': doacao.payment_method === 'Boleto',
                  }"
                ></i>
                <span class="text-sm text-secondary">{{ doacao.payment_method }}</span>
              </div>
            </td>
            <td class="px-6 py-4">
              <p-tag [value]="getStatusLabel(doacao.status)" [severity]="getStatusSeverity(doacao.status)"></p-tag>
            </td>
            <td class="px-6 py-4">
              <div class="flex gap-2">
                <p-button
                  icon="pi pi-eye"
                  size="small"
                  severity="info"
                  [text]="true"
                  pTooltip="Ver detalhes"
                  (onClick)="viewDetails(doacao)"
                ></p-button>

                <p-button
                  *ngIf="canRequestRefund(doacao)"
                  icon="pi pi-undo"
                  size="small"
                  severity="warning"
                  [text]="true"
                  pTooltip="Solicitar reembolso"
                  (click)="requestRefund(doacao)"
                ></p-button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<p-dialog
  [(visible)]="modalDetalhes"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  header="Detalhes da Doação"
  styleClass="w-full max-w-2xl"
>
  <div *ngIf="selectedDoacao" class="space-y-4">
    <div class="bg-surface border border-theme rounded-lg p-4">
      <h4 class="font-semibold text-primary mb-2">Informações da Doação</h4>
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <span class="text-secondary">Campanha:</span>
          <p class="font-medium text-primary">{{ selectedDoacao.title_campanha }}</p>
        </div>
        <div>
          <span class="text-secondary">Valor:</span>
          <p class="font-medium text-green-600">{{ selectedDoacao.amount | currency: 'BRL' : 'symbol' : '1.2-2' }}</p>
        </div>
        <div>
          <span class="text-secondary">Data:</span>
          <p class="font-medium text-primary">{{ selectedDoacao.created_at | date: 'dd/MM/yyyy HH:mm' }}</p>
        </div>
        <div>
          <span class="text-secondary">Pagamento:</span>
          <p class="font-medium text-primary">{{ selectedDoacao.payment_method }}</p>
        </div>
        <div>
          <span class="text-secondary">Status:</span>
          <div class="mt-1">
            <p-tag
              [value]="getStatusLabel(selectedDoacao.status)"
              [severity]="getStatusSeverity(selectedDoacao.status)"
            ></p-tag>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="isRefundRelated(selectedDoacao)" class="bg-surface border border-theme rounded-lg p-4">
      <h4 class="font-semibold text-primary mb-2">Informações do Reembolso</h4>
      <div class="space-y-3 text-sm">
        <div>
          <span class="text-secondary">Status do Reembolso:</span>
          <div class="mt-1">
            <p-tag
              [value]="getStatusLabel(selectedDoacao.status)"
              [severity]="getStatusSeverity(selectedDoacao.status)"
            ></p-tag>
          </div>
        </div>
        <div>
          <span class="text-secondary">Data da Solicitação:</span>
          <p class="font-medium text-primary">{{ selectedDoacao.refund_requested_at | date: 'dd/MM/yyyy' }}</p>
        </div>
        <div
          *ngIf="selectedDoacao.status === StatusDoacao.REFUNDED"
          class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3"
        >
          <div class="flex items-start gap-2">
            <i class="pi pi-check-circle text-green-600 mt-0.5"></i>
            <p class="text-sm text-green-800 dark:text-green-300">
              <strong>Reembolso Aprovado:</strong> O valor será estornado em até 5 dias úteis.
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="flex justify-end gap-3 pt-4 border-t border-theme">
      <p-button label="Fechar" severity="secondary" [text]="true" (onClick)="modalDetalhes = false"></p-button>
    </div>
  </div>
</p-dialog>

