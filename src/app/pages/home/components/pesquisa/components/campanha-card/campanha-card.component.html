<section
  class="hover:scale-105 ease-out duration-200 max-w-[85dvw] md:max-w-[400px] w-[400px] h-[500px] rounded-3xl shadow-2xl cursor-pointer bg-card border border-theme"
  [style.background-image]="
    campanha?.emergency
      ? 'linear-gradient(rgba(255, 255, 255, 6) 0%, rgba(59, 130, 246, 0.75) 95%), url(' + campanha?.image + ')'
      : ''
  "
  [ngClass]="[campanha?.emergency ? 'bg-center bg-cover bg-no-repeat' : '']"
>
  @if (!campanha?.emergency) {
    <div class="relative">
      @if (campanha?.image?.url) {
        <img class="w-full h-[230px] rounded-t-3xl" [src]="campanha?.image?.url" alt="Image of {{ campanha?.title }}" />
      } @else {
        <div class="w-full h-[230px] rounded-t-3xl bg-surface items-center justify-center flex">
          <mat-icon class="text-secondary w-8 h-8" svgIcon="camera-off"></mat-icon>
        </div>
      }
      <p-progressBar
        [pTooltip]="
          'A campanha ' +
          (campanha?.title ?? '') +
          ' já arrecadou R$ ' +
          (campanha?.value_donated ?? 0 | number: '1.0-0') +
          ' de R$ ' +
          (campanha?.value_required | number: '1.0-0') +
          ' (' +
          (campanha?.progress_percentage ?? 0) +
          '% do objetivo)'
        "
        class="absolute z-10 right-2.5 top-2.5 w-[150px]"
        [value]="campanha?.progress_percentage"
      >
      </p-progressBar>
      <p-tag [rounded]="true" class="absolute right-2.5 bottom-2.5 z-10" [value]="campanha!.category[0]" />

      <!-- Status da campanha -->
      @if (campanha?.status !== 'ACTIVE') {
        <p-tag [rounded]="true" class="absolute left-2.5 top-2.5 z-10" value="Finalizada" severity="secondary" />
      }
    </div>
  }
  <section class="flex flex-col py-5 px-7 gap-4 md:gap-4">
    <section class="flex flex-col gap-4">
      <section class="flex items-center justify-between">
        <section class="flex gap-2.5 items-center">
          @if (campanha?.user_responsable && campanha?.user_responsable?.image) {
            <img [src]="campanha?.user_responsable?.image" alt="User profile" />
          } @else {
            <span class="w-8 h-8 flex justify-center items-center bg-blue-500 text-white rounded-full">{{
              (campanha?.user_responsable)!.username[0]
            }}</span>
          }
          <div class="flex flex-col">
            <span [class]="campanha?.emergency ? 'text-black' : 'text-primary'" class="text-sm font-semibold">{{
              (campanha?.user_responsable)!.username
            }}</span>
            @if (!campanha?.emergency) {
              <span class="text-secondary text-xs">{{ (campanha?.user_responsable)!.email }}</span>
            }
          </div>
        </section>
        @if (campanha?.emergency) {
          <p-tag [rounded]="true" [value]="campanha!.category[0]" />
        }
      </section>
      <div class="flex flex-col gap-3">
        <h1
          class="text-2xl font-semibold max-w-full overflow-hidden text-ellipsis whitespace-nowrap"
          [class]="campanha?.emergency ? 'text-black' : 'text-primary'"
          showDelay="500"
          [pTooltip]="campanha?.title"
        >
          {{ campanha?.title }}
        </h1>
        <p
          [ngClass]="[
            campanha?.emergency
              ? 'text-black truncated-text-10l h-[176px]'
              : 'text-secondary truncated-text-3l h-[70px]',
          ]"
          class="max-w-full overflow-hidden text-ellipsis break-all whitespace-pre-line"
          showDelay="500"
          [pTooltip]="campanha?.description"
        >
          {{ campanha?.description }}
        </p>
      </div>
    </section>
    @if (campanha?.emergency) {
      <div class="flex gap-2 flex-col">
        <p-progressBar
          [pTooltip]="
            'A campanha ' +
            (campanha?.title ?? '') +
            ' já arrecadou R$ ' +
            (campanha?.value_donated ?? 0 | number: '1.0-0') +
            ' de R$ ' +
            (campanha?.value_required | number: '1.0-0') +
            ' (' +
            (campanha?.progress_percentage ?? 0) +
            '% do objetivo)'
          "
          class="w-full"
          [value]="campanha?.progress_percentage"
        >
        </p-progressBar>
        <span
          class="text-center font-medium text-sm p-[6px] text-white rounded-lg"
          style="background-color: rgba(8, 14, 190, 0.4)"
          >Campanha urgente validado pela nossa equipe</span
        >
      </div>
    }
    @if (campanha?.users_donated && (campanha?.users_donated)!.length > 0) {
      <section class="flex relative h-8">
        @for (user of campanha?.users_donated!.slice(0, 10); track user; let index = $index) {
          <div
            [style.left]="index > 0 ? index * 25 + 'px' : '0px'"
            [style.z-index]="index"
            class="absolute flex items-center"
            showDelay="500"
            [pTooltip]="user.username"
          >
            @if (user.image) {
              <img
                class="w-8 h-8 rounded-full border-2 border-white"
                [src]="user.image"
                alt="User profile image of {{ user.username }}"
              />
            } @else {
              <span
                class="w-8 h-8 flex justify-center items-center bg-blue-500 text-white rounded-full border-2 border-surface"
                >{{ user.username[0].toUpperCase() }}</span
              >
            }
          </div>
        }
        @if ((campanha?.users_donated)!.length > 10) {
          <span
            [style.left]="10 * 25 + 'px'"
            [style.z-index]="11"
            class="w-8 h-8 text-blue-500 bg-surface flex items-center justify-center rounded-full border-2 border-surface absolute"
            >+{{ campanha?.users_donated ? (campanha?.users_donated)!.length - 10 : 0 }}</span
          >
        }
      </section>
    }

    <section class="flex justify-between items-center pt-3 border-t border-theme">
      <button
        type="button"
        [ngClass]="[campanha?.emergency ? 'text-white' : 'text-secondary']"
        class="flex items-center gap-2 text-sm hover:text-blue-500 transition-colors duration-200"
        (click)="onCommentClick($event)"
      >
        <mat-icon class="text-base" svgIcon="comment-outline"></mat-icon>
        <span>Comentar</span>
      </button>

      <button
        type="button"
        [ngClass]="[campanha?.emergency ? 'text-white' : 'text-secondary']"
        class="flex items-center gap-2 text-sm hover:text-red-500 transition-colors duration-200"
        (click)="onReportClick($event)"
      >
        <mat-icon class="text-base" svgIcon="flag-outline"></mat-icon>
        <span>Denunciar</span>
      </button>
    </section>
  </section>
</section>

