<ng-template #header pTemplate="header" let-onClick="onClick" let-index="index">
  <section class="flex gap-3">
    <div
      class="w-12 h-12 flex items-center justify-center rounded-full transition-colors"
      [ngClass]="{
        'text-white bg-blue-600': activeStep === index,
        'text-secondary bg-surface border border-theme': activeStep !== index,
      }"
    >
      <mat-icon svgIcon="pencil-outline"></mat-icon>
    </div>
    @if (activeStep === index) {
      <div class="flex flex-col justify-center">
        <span class="text-xs text-blue-600 font-bold"> Passo {{ index + 1 }}/{{ totalSteps }} </span>
        <span class="text-primary">Conhecendo a campanha</span>
      </div>
    }
  </section>
</ng-template>
<ng-template
  #content
  pTemplate="content"
  let-prevCallback="prevCallback"
  let-nextCallback="nextCallback"
  let-index="index"
>
  <form *ngIf="campanhaForm" [formGroup]="campanhaForm" class="flex flex-col min-h-[600px] p-6 gap-6 bg-card">
    <div class="flex flex-col gap-2">
      <h1 class="text-xl text-primary font-bold">Fale um pouco mais</h1>
      <span class="text-secondary max-w-[400px]"
        >Escreva mais detalhes sobre sua campanha, não economize nas palavras.</span
      >
    </div>
    <section class="flex-1 gap-6 flex flex-col">
      <section class="flex gap-2 justify-between">
        <div class="flex flex-col gap-1.5 w-[88%]">
          <label for="title" class="text-sm text-secondary font-medium">Título da campanha</label>
          <input
            type="text"
            pInputText
            formControlName="title"
            (blur)="title?.invalid && title?.markAsDirty()"
            placeholder="Seu título aqui"
          />

          <div
            class="flex align-items-end text-xs"
            [ngClass]="title?.invalid && (title?.dirty || title?.touched) ? 'justify-between' : 'justify-end'"
          >
            <span
              [ngClass]="
                title?.invalid && (title?.dirty || title?.touched) ? 'visible text-red-600' : 'invisible text-red-600'
              "
            >
              <ng-container *ngIf="title?.errors as errors">
                <ng-container *ngIf="errors['required']">Campo obrigatório!</ng-container>
                <ng-container *ngIf="errors['minlength']">Mínimo de 3 caracteres.</ng-container>
                <ng-container *ngIf="errors['maxlength']">Máximo de 100 caracteres.</ng-container>
              </ng-container>
            </span>
            <span class="text-secondary">{{ title?.value?.length || 0 }}/100</span>
          </div>
        </div>
        <div class="flex gap-2 items-center pt-[10px]">
          <p-toggleButton
            class="mb-[6px] w-[120px]"
            formControlName="emergency"
            onLabel="Urgente"
            offLabel="Não urgente"
          ></p-toggleButton>
          <p-toggleButton
            class="mb-[6px] w-[160px]"
            formControlName="have_address"
            [onLabel]="'Contém endereço'"
            [offLabel]="'Sem endereço'"
            (onChange)="handleHaveAddressChange()"
          ></p-toggleButton>
        </div>
      </section>

      <div class="flex flex-col gap-1.5">
        <div *ngIf="image?.value?.url && !imagemSelecionada" class="mb-4">
          <div class="bg-surface border border-theme rounded-lg p-4">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-3">
                <div class="w-16 h-16 rounded-lg overflow-hidden border border-theme">
                  <img [src]="image?.value?.url || ''" alt="Imagem da campanha" class="w-full h-full object-cover" />
                </div>
                <div>
                  <p class="text-sm font-medium text-primary">Imagem atual da campanha</p>
                  <p class="text-xs text-secondary">Clique em "Escolher Imagem" para alterar</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <p-fileUpload
          #fileUpload
          mode="advanced"
          [multiple]="false"
          accept="image/*"
          [maxFileSize]="5000000"
          chooseLabel="Escolher Imagem"
          cancelLabel="Cancelar"
          [auto]="false"
          [customUpload]="true"
          [showUploadButton]="false"
          [showCancelButton]="false"
          (onSelect)="onUpload($event)"
          (onRemove)="removerImagem()"
          class="w-full"
        >
          <ng-template pTemplate="content">
            <div class="p-6 text-center">
              <i class="pi pi-cloud-upload text-4xl text-primary mb-4 block"></i>
              <p class="text-secondary mb-2">
                <strong class="text-blue-600 font-semibold">Selecione</strong> uma foto para representar sua campanha
              </p>
              <p class="text-xs text-secondary">PNG, JPG ou JPEG até 5MB</p>
            </div>
          </ng-template>
        </p-fileUpload>
      </div>

      <div class="flex flex-col gap-1.5">
        <label for="description" class="text-sm text-secondary font-medium">Descrição</label>
        <textarea
          rows="5"
          cols="30"
          pInputTextarea
          placeholder="Escreva a descrição da sua campanha, não economize nas palavras"
          formControlName="description"
          (blur)="description?.invalid && description?.markAsDirty()"
        ></textarea>

        <div
          class="flex align-items-end text-xs"
          [ngClass]="
            description?.invalid && (description?.dirty || description?.touched) ? 'justify-between' : 'justify-end'
          "
        >
          <span
            [ngClass]="
              description?.invalid && (description?.dirty || description?.touched)
                ? 'visible text-red-600'
                : 'invisible text-red-600'
            "
          >
            <ng-container *ngIf="description?.errors as errors">
              <ng-container *ngIf="errors['required']">Campo obrigatório!</ng-container>
              <ng-container *ngIf="errors['minlength']">Mínimo de 10 caracteres.</ng-container>
              <ng-container *ngIf="errors['maxlength']">Máximo de 500 caracteres.</ng-container>
            </ng-container>
          </span>
          <span class="text-secondary">{{ description?.value?.length || 0 }}/500</span>
        </div>
      </div>
    </section>
    <section class="flex justify-between items-center pt-4 border-t border-theme">
      <p-button label="Cancelar" severity="secondary" [outlined]="true" iconPos="right" (onClick)="onCancel.emit()" />
      <div class="flex justify-end gap-2">
        <p-button
          label="Voltar"
          severity="secondary"
          [outlined]="true"
          icon="pi pi-arrow-left"
          (onClick)="prevCallback.emit()"
        />
        <p-button
          [disabled]="validateDescricaoStep()"
          label="Continuar"
          icon="pi pi-arrow-right"
          iconPos="right"
          (onClick)="nextCallback.emit()"
        />
      </div>
    </section>
  </form>
</ng-template>

