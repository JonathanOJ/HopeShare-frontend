<ng-template #header pTemplate="header" let-onClick="onClick" let-index="index">
  <section class="flex gap-3">
    <div
      class="w-[48px] h-[48px] flex items-center justify-center rounded-full"
      [ngClass]="{
        'text-white': activeStep === index,
        'text-[#D1D1D1]': activeStep !== index,
        'bg-[#3b82f6]': activeStep === index,
        'bg-[#F6F6F6]': activeStep !== index,
      }"
    >
      <mat-icon svgIcon="check"></mat-icon>
    </div>
    @if (activeStep === index) {
      <div class="flex flex-col justify-center">
        <span class="text-xs text-[#3b82f6] font-bold"> Passo {{ index + 1 }}/{{ totalSteps }} </span>
        <span class="text-[#454545]" (click)="log()">Revisando</span>
      </div>
    }
  </section>
</ng-template>

<ng-template #content pTemplate="content" let-prevCallback="prevCallback" let-index="index">
  <p-tabMenu [model]="tabItems" [(activeItem)]="activeTab"> </p-tabMenu>
  <div class="pt-6">
    <!-- Tab 1: Resumo -->
    <ng-container *ngIf="activeTab?.label === 'Resumo'">
      <div class="flex flex-col h-[700px] p-6 gap-6">
        <div class="flex flex-col gap-2">
          <h1 class="text-xl text-[#3d3d3d] font-bold">Falta pouco...</h1>
          <span class="text-[#4F4F4F] max-w-[400px]"
            >Revise seu campanha, veja se está como você gostaria antes de publica-lo para todos.</span
          >
        </div>
        <section class="h-[482px] w-full gap-6 flex flex-row">
          <section class="w-[60%] flex flex-col gap-5">
            <section class="flex gap-2 items-end justify-between">
              <div class="flex flex-col gap-1.5 w-full">
                <span class="text-sm text-[#4F4F4F]">Titulo</span>
                <input
                  [disabled]="true"
                  type="text"
                  pInputText
                  [(ngModel)]="campanha.title"
                  required
                  placeholder="Seu titulo aqui"
                />
              </div>
              <p-toggleButton
                class="mb-[6px] w-[120px]"
                [disabled]="true"
                [(ngModel)]="campanha.request_emergency"
                onLabel="Urgente"
                offLabel="Não urgente"
              ></p-toggleButton>
            </section>
            <div class="flex flex-col gap-1.5">
              <span class="text-sm text-[#4F4F4F]">Categorias</span>
              <input
                [disabled]="true"
                type="text"
                pInputText
                [(ngModel)]="campanha.categoriesFormatted"
                required
                placeholder="Seu titulo aqui"
              />
            </div>
            <div class="flex flex-col gap-1.5">
              <span class="text-sm text-[#4F4F4F]">Valor solicitador</span>
              <span
                class="w-full font-bold text-[#3b82f6] flex items-center justify-center h-[80px] rounded-lg border-[#E7E7E7] border"
              >
                {{ campanha.value_required | formatValueBrl }}
              </span>
            </div>
            <div class="flex flex-col gap-1.5">
              <span class="text-sm text-[#4F4F4F]">Descrição</span>
              <textarea
                rows="5"
                cols="30"
                [disabled]="true"
                pInputTextarea
                placeholder="Escreva a descrição do seu campanha, não economize nas palavras"
                [(ngModel)]="campanha.description"
              ></textarea>
            </div>
          </section>
          <div class="w-[40%] h-[482px]">
            @if (campanha.image) {
              <img class="h-full w-full rounded-3xl" [src]="campanha.image" alt="imagem da campanha" />
            } @else {
              <div class="h-full w-full flex items-center justify-center rounded-3xl bg-[#c8c8c8]">
                <mat-icon style="color: gray" svgIcon="camera-off"></mat-icon>
              </div>
            }
          </div>
        </section>
        <section class="flex justify-between">
          <p-button label="Cancelar" severity="danger" iconPos="right" (onClick)="onCancel.emit()" />
          <div class="flex justify-end gap-2">
            <p-button label="Voltar" [outlined]="true" (onClick)="prevCallback.emit()" />
            <p-button [label]="!editMode ? 'Criar' : 'Salvar'" (onClick)="onSave.emit(campanha)" />
          </div>
        </section>
      </div>
    </ng-container>
    <!-- Tab 2: Endereço -->
    <ng-container *ngIf="activeTab?.label === 'Endereço'">
      <div class="flex flex-col h-[700px] p-6 gap-6">
        <div class="flex flex-col gap-2">
          <h1 class="text-xl text-[#3d3d3d] font-bold">Endereço</h1>
          <span class="text-[#4F4F4F] max-w-[400px]">Confira os dados do endereço da campanha.</span>
        </div>
        <section class="h-[482px] gap-6 flex flex-row">
          <!-- Informações de Endereço -->
          <section class="w-1/2 gap-2 flex flex-col">
            <section class="flex gap-2 justify-between">
              <div class="flex flex-col gap-1.5 w-full">
                <span class="text-sm text-[#4F4F4F]">Rua</span>
                <input [disabled]="true" type="text" pInputText [(ngModel)]="campanha.address_street" />
              </div>
              <div class="flex flex-col gap-1.5">
                <span class="text-sm text-[#4F4F4F]">Número</span>
                <input [disabled]="true" type="text" pInputText [(ngModel)]="campanha.address_number" />
              </div>
            </section>
            <section class="flex gap-2 justify-between">
              <div class="flex flex-col gap-1.5 w-1/2">
                <span class="text-sm text-[#4F4F4F]">Complemento</span>
                <input [disabled]="true" type="text" pInputText [(ngModel)]="campanha.address_complement" />
              </div>
              <div class="flex flex-col gap-1.5 w-1/2">
                <span class="text-sm text-[#4F4F4F]">Cidade</span>
                <input [disabled]="true" type="text" pInputText [(ngModel)]="campanha.address_city" />
              </div>
            </section>
            <section class="flex gap-2 justify-between">
              <div class="flex flex-col gap-1.5 w-1/2">
                <span class="text-sm text-[#4F4F4F]">Estado</span>
                <input [disabled]="true" type="text" pInputText [(ngModel)]="campanha.address_state" />
              </div>
              <div class="flex flex-col gap-1.5 w-1/2">
                <span class="text-sm text-[#4F4F4F]">Bairro</span>
                <input [disabled]="true" type="text" pInputText [(ngModel)]="campanha.address_neighborhood" />
              </div>
            </section>
            <section>
              <div class="flex flex-col gap-1.5 w-1/2">
                <span class="text-sm text-[#4F4F4F]">CEP</span>
                <input [disabled]="true" type="text" pInputText [(ngModel)]="campanha.address_zipcode" />
              </div>
            </section>
          </section>

          <!-- Google Maps -->
          <section class="w-1/2 flex flex-col gap-2">
            <div class="flex justify-between items-center">
              <span class="text-sm text-[#4F4F4F]">Localização no Mapa</span>
              @if (getGoogleMapsLink()) {
                <a
                  [href]="getGoogleMapsLink()"
                  target="_blank"
                  class="text-xs text-[#3b82f6] hover:underline flex items-center gap-1"
                >
                  <mat-icon class="text-sm" svgIcon="open-in-new"></mat-icon>
                  Abrir no Google Maps
                </a>
              }
            </div>
            <div
              class="h-full border rounded-lg overflow-hidden bg-gray-50 flex items-center justify-center relative min-h-[300px]"
            >
              @if (getGoogleMapsUrl()) {
                <iframe
                  [src]="getGoogleMapsUrl()"
                  width="100%"
                  height="100%"
                  style="border: 0; min-height: 300px"
                  allowfullscreen=""
                  loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade"
                  title="Localização da campanha"
                  class="rounded-lg"
                >
                </iframe>
              } @else {
                <div class="text-center text-gray-500 p-8">
                  <mat-icon class="text-5xl mb-3 text-gray-400" svgIcon="map-marker-outline"></mat-icon>
                  <p class="font-medium text-base mb-1">Mapa não disponível</p>
                  <p class="text-sm text-gray-400">Preencha todos os dados de endereço para visualizar o mapa</p>
                </div>
              }
            </div>
          </section>
        </section>
        <section class="flex justify-between">
          <p-button label="Cancelar" severity="danger" iconPos="right" (onClick)="onCancel.emit()" />
          <div class="flex justify-end gap-2">
            <p-button label="Voltar" [outlined]="true" (onClick)="prevCallback.emit()" />
            <p-button [label]="!editMode ? 'Criar' : 'Salvar'" (onClick)="onSave.emit(campanha)" />
          </div>
        </section>
      </div>
    </ng-container>
  </div>
</ng-template>

