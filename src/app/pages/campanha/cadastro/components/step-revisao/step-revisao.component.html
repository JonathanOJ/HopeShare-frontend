<ng-template #header pTemplate="header" let-onClick="onClick" let-index="index">
  <section class="flex gap-3">
    <div
      class="w-12 h-12 flex items-center justify-center rounded-full transition-colors"
      [ngClass]="{
        'text-white bg-blue-600': activeStep === index,
        'text-secondary bg-surface border border-theme': activeStep !== index,
      }"
    >
      <mat-icon svgIcon="check"></mat-icon>
    </div>
    @if (activeStep === index) {
      <div class="flex flex-col justify-center">
        <span class="text-xs text-blue-600 font-bold"> Passo {{ index + 1 }}/{{ totalSteps }} </span>
        <span class="text-primary">Revisando</span>
      </div>
    }
  </section>
</ng-template>

<ng-template #content pTemplate="content" let-prevCallback="prevCallback" let-index="index">
  <div class="bg-card">
    <p-tabMenu [model]="tabItems" [(activeItem)]="activeTab"> </p-tabMenu>
    <div class="pt-6">
      <ng-container *ngIf="activeTab?.label === 'Resumo'">
        <div class="flex flex-col min-h-[600px] p-6 gap-6">
          <div class="flex flex-col gap-2">
            <h1 class="text-xl text-primary font-bold">Falta pouco...</h1>
            <span class="text-secondary max-w-[400px]"
              >Revise sua campanha, veja se está como você gostaria antes de publicá-la para todos.</span
            >
          </div>
          <section class="h-[482px] w-full gap-6 flex flex-row">
            <section class="w-[60%] flex flex-col gap-5">
              <section class="flex gap-2 items-end justify-between">
                <div class="flex flex-col gap-1.5 w-full">
                  <span class="text-sm text-secondary font-medium">Título</span>
                  <input
                    [disabled]="true"
                    type="text"
                    pInputText
                    [(ngModel)]="title"
                    required
                    placeholder="Seu título aqui"
                  />
                </div>
                <p-toggleButton
                  class="mb-[6px] w-[120px]"
                  [disabled]="true"
                  [(ngModel)]="request_emergency"
                  onLabel="Urgente"
                  offLabel="Não urgente"
                ></p-toggleButton>
              </section>
              <div class="flex flex-col gap-1.5">
                <span class="text-sm text-secondary font-medium">Categorias</span>
                <input
                  [disabled]="true"
                  type="text"
                  pInputText
                  [(ngModel)]="categoriesFormatted"
                  required
                  placeholder="Suas categorias aqui"
                />
              </div>
              <div class="flex flex-col gap-1.5">
                <span class="text-sm text-secondary font-medium">Valor solicitado</span>
                <span
                  class="w-full font-bold text-blue-600 flex items-center justify-center h-[80px] rounded-lg border-theme border bg-surface"
                >
                  {{ value_required | currency: 'BRL' : 'symbol' : '1.2-2' }}
                </span>
              </div>
              <div class="flex flex-col gap-1.5">
                <span class="text-sm text-secondary font-medium">Descrição</span>
                <textarea
                  rows="5"
                  cols="30"
                  [disabled]="true"
                  pInputTextarea
                  placeholder="Escreva a descrição da sua campanha, não economize nas palavras"
                  [(ngModel)]="description"
                ></textarea>
              </div>
            </section>
            <div class="w-[40%] h-[482px]">
              @if (imagePreviewUrl) {
                <img
                  class="h-full w-full rounded-3xl border border-theme object-cover"
                  [src]="imagePreviewUrl"
                  alt="imagem da campanha"
                />
              } @else {
                <div class="h-full w-full flex items-center justify-center rounded-3xl bg-surface border border-theme">
                  <mat-icon class="text-secondary text-6xl" svgIcon="camera-off"></mat-icon>
                </div>
              }
            </div>
          </section>
        </div>
      </ng-container>
      <ng-container *ngIf="activeTab?.label === 'Endereço'">
        <div class="flex flex-col min-h-[600px] p-6 gap-6">
          <div class="flex flex-col gap-2">
            <h1 class="text-xl text-primary font-bold">Endereço</h1>
            <span class="text-secondary max-w-[400px]">Confira os dados do endereço da campanha.</span>
          </div>
          <section class="h-[482px] gap-6 flex flex-row">
            <section class="w-1/2 gap-2 flex flex-col">
              <section class="flex gap-2 justify-between">
                <div class="flex flex-col gap-1.5 w-full">
                  <span class="text-sm text-secondary font-medium">Rua</span>
                  <input [disabled]="true" type="text" pInputText [(ngModel)]="street" />
                </div>
                <div class="flex flex-col gap-1.5">
                  <span class="text-sm text-secondary font-medium">Número</span>
                  <input [disabled]="true" type="text" pInputText [(ngModel)]="number" />
                </div>
              </section>
              <section class="flex gap-2 justify-between">
                <div class="flex flex-col gap-1.5 w-1/2">
                  <span class="text-sm text-secondary font-medium">Complemento</span>
                  <input [disabled]="true" type="text" pInputText [(ngModel)]="complement" />
                </div>
                <div class="flex flex-col gap-1.5 w-1/2">
                  <span class="text-sm text-secondary font-medium">Cidade</span>
                  <input [disabled]="true" type="text" pInputText [(ngModel)]="city" />
                </div>
              </section>
              <section class="flex gap-2 justify-between">
                <div class="flex flex-col gap-1.5 w-1/2">
                  <span class="text-sm text-secondary font-medium">Estado</span>
                  <input [disabled]="true" type="text" pInputText [(ngModel)]="state" />
                </div>
                <div class="flex flex-col gap-1.5 w-1/2">
                  <span class="text-sm text-secondary font-medium">Bairro</span>
                  <input [disabled]="true" type="text" pInputText [(ngModel)]="neighborhood" />
                </div>
              </section>
              <section>
                <div class="flex flex-col gap-1.5 w-1/2">
                  <span class="text-sm text-secondary font-medium">CEP</span>
                  <input [disabled]="true" type="text" pInputText [(ngModel)]="zipcode" />
                </div>
              </section>
            </section>

            <section class="w-1/2 flex flex-col gap-2">
              <div class="flex justify-between items-center">
                <span class="text-sm text-secondary font-medium">Localização no Mapa</span>
                <a
                  [href]="getGoogleMapsLink()"
                  target="_blank"
                  class="text-xs text-blue-600 hover:underline flex items-center gap-1"
                >
                  <mat-icon class="text-sm" svgIcon="open-in-new"></mat-icon>
                  Abrir no Google Maps
                </a>
              </div>
              <div
                class="h-full border border-theme rounded-lg overflow-hidden bg-surface flex items-center justify-center relative min-h-[300px]"
              >
                @if (mapUrl) {
                  <iframe
                    [src]="mapUrl"
                    width="100%"
                    height="100%"
                    style="border: 0; min-height: 300px"
                    allowfullscreen=""
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    title="Localização da campanha"
                    class="rounded-lg"
                  >
                  </iframe>
                } @else {
                  <div class="text-center text-secondary p-8">
                    <mat-icon class="text-5xl mb-3 text-secondary" svgIcon="map-marker-outline"></mat-icon>
                    <p class="font-medium text-base mb-1 text-primary">Mapa não disponível</p>
                    <p class="text-sm text-secondary">Preencha todos os dados de endereço para visualizar o mapa</p>
                  </div>
                }
              </div>
            </section>
          </section>
        </div>
      </ng-container>
      <section class="flex justify-between items-center pt-4 border-t border-theme">
        <p-button label="Cancelar" severity="secondary" [outlined]="true" iconPos="right" (onClick)="onCancel.emit()" />
        <div class="flex justify-end gap-2">
          <p-button
            label="Voltar"
            severity="secondary"
            [outlined]="true"
            icon="pi pi-arrow-left"
            (onClick)="prevCallback.emit()"
          />
          <p-button
            [label]="campanha_id ? 'Salvar' : 'Criar'"
            icon="pi pi-check"
            iconPos="right"
            (onClick)="onSave.emit()"
          />
        </div>
      </section>
    </div>
  </div>
</ng-template>

